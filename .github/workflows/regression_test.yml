# ============================================================
# REGRESSION TESTS WORKFLOW
# ------------------------------------------------------------
# This workflow runs the full regression test suite.
#
# It is triggered in two ways:
#   1. AUTOMATICALLY â€” after Smoke Tests pass on a push to main
#   2. MANUALLY â€” from the GitHub Actions UI with custom options
#
# Key design decisions:
#   - Regression NEVER runs if smoke failed (guarded in Step 0)
#   - Regression NEVER auto-runs if smoke was manually triggered
#     (manual smoke = exploratory run, not a full pipeline)
#   - Regression failure is NON-BLOCKING â€” pipeline won't turn red
#     (smoke is the quality gate; regression is informational)
#   - Build numbers are paired with smoke when auto-triggered,
#     or prefixed with "m" (e.g. m42) when manually triggered
# ============================================================

name: Regression Tests Execution

# â”€â”€ When does this workflow run? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  workflow_run:
    workflows: ["Smoke Tests Execution"]   # Listens for smoke workflow to finish
    types:
      - completed                          # Triggers when smoke completes (pass or fail)

  workflow_dispatch:                       # Also allows manual trigger from GitHub Actions UI
    inputs:
      env:
        description: 'Test environment'
        default: 'qa'
      browser:
        description: 'Browser to run tests'
        default: 'chromium'
      headless:
        description: 'Headless mode'
        default: 'true'
      threadcount:
        description: 'Parallel threads'
        default: '1'
      tag:
        description: 'Cucumber tags'
        default: '@regression'

jobs:
  regression-job:
    runs-on: ubuntu-latest

    # â”€â”€ Job-level guard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Prevents the job from even starting if:
    #   - It was triggered by workflow_run AND smoke didn't succeed
    # This is a first line of defence; Step 0 adds a second check.
    if: >
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'workflow_run' &&
       github.event.workflow_run.conclusion == 'success')

    steps:

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 0ï¸âƒ£  Guard â€” decide whether regression should proceed
      # This is the main safety check. It handles 3 scenarios:
      #   a) Smoke was manually triggered â†’ skip regression
      #      (manual smoke runs are one-off checks, not full pipelines)
      #   b) Smoke failed or was cancelled â†’ skip regression
      #   c) Smoke passed via a code push â†’ proceed with regression
      #   d) This is a manual regression trigger â†’ always proceed
      #
      # The result is stored as "proceed=true/false" and every
      # subsequent step checks this before doing any work.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Check Smoke Conclusion
        id: guard
        run: |
          CONCLUSION="${{ github.event.workflow_run.conclusion }}"
          TRIGGER_EVENT="${{ github.event.workflow_run.event }}"
          echo "Smoke workflow conclusion: ${CONCLUSION}"
          echo "Smoke was triggered by: ${TRIGGER_EVENT}"

          if [ "${{ github.event_name }}" = "workflow_run" ]; then
            if [ "${TRIGGER_EVENT}" = "workflow_dispatch" ]; then
              echo "â„¹ï¸  Smoke was manually triggered â€” regression will not auto-run"
              echo "proceed=false" >> $GITHUB_OUTPUT
            elif [ "${CONCLUSION}" != "success" ]; then
              echo "âŒ Smoke did not pass (conclusion: ${CONCLUSION}) â€” skipping regression"
              echo "proceed=false" >> $GITHUB_OUTPUT
            else
              echo "âœ… Smoke passed via push â€” proceeding with regression"
              echo "proceed=true" >> $GITHUB_OUTPUT
            fi
          else
            echo "âœ… Manual regression trigger â€” proceeding"
            echo "proceed=true" >> $GITHUB_OUTPUT
          fi

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 1ï¸âƒ£  Checkout main branch
      # Downloads your project code onto the CI machine.
      # Skipped entirely if the guard said proceed=false.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Checkout Main
        if: steps.guard.outputs.proceed == 'true'
        uses: actions/checkout@v4

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 2ï¸âƒ£  Setup Java 21
      # Installs Java (required to run Maven + your framework).
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Setup Java
        if: steps.guard.outputs.proceed == 'true'
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 3ï¸âƒ£  Install Allure CLI
      # Required to convert raw test results into
      # a visual HTML report at the end of the run.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Install Allure CLI
        if: steps.guard.outputs.proceed == 'true'
        run: npm install -g allure-commandline

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 4ï¸âƒ£  Install Playwright browsers
      # Downloads browser binaries + system dependencies
      # needed for Playwright to run tests on this CI machine.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Install Playwright Browsers
        if: steps.guard.outputs.proceed == 'true'
        run: mvn exec:java -e -D exec.mainClass=com.microsoft.playwright.CLI -D exec.args="install --with-deps" -D exec.classpathScope=test

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 5ï¸âƒ£  Restore shared Allure history from gh-pages
      # Fetches previous build history so Allure can render
      # trend graphs showing pass/fail rates over time.
      # continue-on-error: true â†’ safe to skip on first run
      # when gh-pages doesn't exist yet.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Checkout gh-pages for History
        if: steps.guard.outputs.proceed == 'true'
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          path: gh-pages
        continue-on-error: true

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 6ï¸âƒ£  Resolve build number
      # Build numbers are handled differently depending on trigger:
      #
      #   AUTO (triggered by smoke push):
      #     â†’ Uses smoke's run number so both reports are paired
      #       under the same build ID on the dashboard
      #
      #   MANUAL (triggered directly):
      #     â†’ Uses own run number prefixed with "m" (e.g. m42)
      #       so the dashboard can distinguish it from auto builds
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Resolve Build Number
        if: steps.guard.outputs.proceed == 'true'
        id: build
        run: |
          if [ "${{ github.event_name }}" = "workflow_run" ]; then
            echo "number=${{ github.event.workflow_run.run_number }}" >> $GITHUB_OUTPUT
            echo "â„¹ï¸  Auto-triggered â€” using smoke build number: ${{ github.event.workflow_run.run_number }}"
          else
            # Prefix "m" marks this as a manual regression run
            echo "number=m${{ github.run_number }}" >> $GITHUB_OUTPUT
            echo "â„¹ï¸  Manual trigger â€” using build ID: m${{ github.run_number }}"
          fi

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 7ï¸âƒ£  Run Regression Tests
      # Runs the full regression suite using Maven + TestNG.
      #   - xvfb-run: creates a virtual display for browser rendering
      #   - testng-regression.xml: the TestNG suite for regression
      #   - All test options pulled from inputs (or defaults)
      #   - continue-on-error: true â†’ keeps going even on failure
      #     so reports are always generated regardless of outcome
      #
      # Note: env vars are defined separately under "env:" to keep
      # the run command clean and readable.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Run Regression Tests
        if: steps.guard.outputs.proceed == 'true'
        id: run
        continue-on-error: true
        env:
          TAGS: ${{ github.event.inputs.tag || '@regression' }}
          ENV: ${{ github.event.inputs.env || 'qa' }}
          BROWSER: ${{ github.event.inputs.browser || 'chromium' }}
          HEADLESS: ${{ github.event.inputs.headless || 'true' }}
          THREADS: ${{ github.event.inputs.threadcount || '1' }}
        run: |
          xvfb-run --auto-servernum -- mvn clean test \
            -Dtestng.suite.file=testng-regression.xml \
            -Dcucumber.filter.tags="${TAGS}" \
            -Denv="${ENV}" \
            -Dbrowser="${BROWSER}" \
            -Dheadless="${HEADLESS}" \
            -Dparallel.thread.count="${THREADS}" \
            -Dallure.results.directory=target/allure-results

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # History is restored AFTER tests run (not before)
      # because "mvn clean" wipes the target/ folder.
      # Restoring before tests would delete the history.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Restore Shared History into allure-results
        if: steps.guard.outputs.proceed == 'true'
        run: |
          mkdir -p target/allure-results/history
          if [ -d gh-pages/allure-history/shared/history ]; then
            echo "âœ… Shared history found â€” restoring after test run"
            cp -r gh-pages/allure-history/shared/history/. target/allure-results/history/
          else
            echo "â„¹ï¸  No shared history yet â€” first run"
          fi

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 8ï¸âƒ£  Debug â€” verify outputs
      # Prints folder contents to CI logs so you can confirm
      # results, history, and env properties were created correctly.
      # ğŸ’¡ Safe to remove once everything is confirmed working.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Debug â€” Verify Output Paths
        if: steps.guard.outputs.proceed == 'true'
        run: |
          echo "====== target/allure-results ======"
          ls -la target/allure-results/ || echo "âŒ NOT FOUND"
          echo "====== history ======"
          ls -la target/allure-results/history/ || echo "âŒ history empty or missing"
          echo "====== environment.properties ======"
          cat target/allure-results/environment.properties || echo "âŒ NOT FOUND"
          echo "====== test-output ======"
          find . -path ./gh-pages -prune -o -name "failedLocators_*.json" -print
          echo "====== defect-age-report ======"
          find . -path ./gh-pages -prune -o -name "defect-age-report.csv" -print

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 9ï¸âƒ£  Generate Defect Age Report
      # Runs a custom Java utility that tracks how long
      # each failing test has been continuously failing.
      # Output is a CSV attached to the Allure report.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Generate Defect Age Report
        if: steps.guard.outputs.proceed == 'true'
        env:
          ENV: ${{ github.event.inputs.env || 'qa' }}
          BROWSER: ${{ github.event.inputs.browser || 'chromium' }}
          HEADLESS: ${{ github.event.inputs.headless || 'true' }}
        run: |
          mvn exec:java \
            -Dexec.mainClass="com.samtech.qa.testutilities.AllureDefectAge" \
            -Dexec.classpathScope=test \
            -Denv="${ENV}" \
            -Dbrowser="${BROWSER}" \
            -Dheadless="${HEADLESS}"
          echo "====== defect-age-report.csv ======"
          cat target/defect-age-report.csv || echo "âŒ not generated"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ”Ÿ  Generate Allure HTML Report
      # Converts raw JSON result files into a full interactive
      # HTML report (allure-report-regression/).
      # The --clean flag removes any leftover files from old runs.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Generate Allure Report
        if: steps.guard.outputs.proceed == 'true'
        run: |
          allure generate target/allure-results -o allure-report-regression --clean
          echo "====== allure-report-regression/history ======"
          ls allure-report-regression/history/ || echo "âŒ history missing"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 1ï¸âƒ£1ï¸âƒ£  Publish to GitHub Pages
      # This step does several things:
      #   1. Saves the latest Allure history (for future trend graphs)
      #   2. Saves this build's report as a versioned snapshot
      #   3. Writes metadata (pass/fail + timestamp) for the dashboard
      #   4. If manual run, adds build ID to a manifest file so the
      #      dashboard can discover it (manual builds don't pair with smoke)
      #   5. Cleans up old builds (keeps last 20 only)
      #   6. Checks if dashboard index.html exists (smoke owns it;
      #      regression just pushes its data alongside it)
      #   7. Commits and pushes everything to the gh-pages branch
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Update gh-pages â€” History + Versioned Report + Index
        if: steps.guard.outputs.proceed == 'true'
        run: |
          BUILD=${{ steps.build.outputs.number }}
          REPO_NAME=$(echo '${{ github.repository }}' | cut -d'/' -f2)
          REPO_URL="https://${{ github.repository_owner }}.github.io/${REPO_NAME}"
          MAX_BUILDS=20

          # â”€â”€ Clone the existing gh-pages branch â”€â”€
          # Unlike smoke, regression assumes gh-pages already exists
          # (smoke always runs first and creates it on first run)
          rm -rf gh-pages-push
          git clone --branch gh-pages --single-branch \
            https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git \
            gh-pages-push

          cd gh-pages-push

          # â”€â”€ Save shared Allure history (used for trend graphs in future builds) â”€â”€
          mkdir -p allure-history/shared
          rm -rf allure-history/shared/history
          cp -r ../allure-report-regression/history allure-history/shared/history

          # â”€â”€ Save a versioned copy of this build's regression report â”€â”€
          mkdir -p regression-report/build-${BUILD}
          cp -r ../allure-report-regression/. regression-report/build-${BUILD}/

          # â”€â”€ Write build metadata: outcome (success/failure) + Unix timestamp â”€â”€
          mkdir -p build-meta
          echo "${{ steps.run.outcome }}|$(date +%s)" > build-meta/regression-${BUILD}.txt

          # â”€â”€ If this is a manual regression run, record it in a manifest â”€â”€
          # The dashboard reads this file to discover manual builds
          # that don't have a paired smoke entry
          if [[ "${BUILD}" == m* ]]; then
            echo "${BUILD}" >> build-meta/manual-regression-builds.txt
          fi

          # â”€â”€ Remove oldest builds if we exceed MAX_BUILDS limit â”€â”€
          cd regression-report
          ls -d build-* 2>/dev/null | sort -t- -k2 -n | head -n -${MAX_BUILDS} | xargs rm -rf 2>/dev/null || true
          cd ..

          # â”€â”€ Dashboard index.html is owned by the smoke workflow â”€â”€
          # Regression doesn't regenerate it â€” smoke will update it
          # on the next run, picking up the regression data automatically
          if [ -f index.html ]; then
            echo "âœ… index.html already exists â€” will be updated by next smoke run"
          fi

          # â”€â”€ Commit and push all changes to gh-pages â”€â”€
          git config user.name  "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          # Only commit if there are actual changes (avoids empty commits)
          git diff --cached --quiet \
            && echo "â„¹ï¸  No changes to commit" \
            || git commit -m "chore(regression): build #${BUILD} [skip ci]"
          git pull --rebase origin gh-pages || true   # Sync with remote before pushing
          git push origin gh-pages
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}   # Auto-provided by GitHub â€” no setup needed

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 1ï¸âƒ£2ï¸âƒ£  Upload artifacts
      # Saves key output files in GitHub Actions UI for
      # manual download and inspection. Kept for 30 days.
      # Includes: raw results, HTML report, defect CSV,
      # failed locators JSON, and test logs.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Upload Regression Artifacts
        if: steps.guard.outputs.proceed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: regression-artifacts-build-${{ steps.build.outputs.number }}
          if-no-files-found: warn
          retention-days: 30
          path: |
            target/allure-results/
            allure-report-regression/
            target/defect-age-report.csv
            test-output/failedLocators_*.json
            test-output/logs/

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 1ï¸âƒ£3ï¸âƒ£  Report outcome â€” NON-BLOCKING
      # Unlike smoke, regression failure does NOT fail the pipeline.
      # The goal here is visibility â€” the team can see what failed
      # in the report, but it won't block merges or deployments.
      # Smoke is the hard quality gate; regression is informational.
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Report Regression Outcome
        if: steps.guard.outputs.proceed == 'true'
        run: |
          if [ "${{ steps.run.outcome }}" = "failure" ]; then
            echo "âš ï¸  Regression tests FAILED â€” check the report"
            echo "â„¹ï¸  Pipeline continues â€” regression is non-blocking"
          else
            echo "âœ… All regression tests passed"
          fi